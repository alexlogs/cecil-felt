<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Felt Map Integration</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
        }
        header {
            background-color: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e1e4e8;
        }
        h1 {
            margin: 0;
            font-size: 24px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .map-container {
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }
        #feltMap {
            width: 100%;
            height: 100%;
        }
        .controls {
            margin-bottom: 20px;
        }
        input, select, button {
            padding: 8px 12px;
            margin-right: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #0366d6;
            color: white;
            cursor: pointer;
            border: none;
        }
        button:hover {
            background-color: #0255b3;
        }
        .map-list {
            margin-top: 20px;
        }
        .map-item {
            padding: 10px;
            border: 1px solid #e1e4e8;
            border-radius: 4px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .map-item:hover {
            background-color: #f6f8fa;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Felt Map Viewer</h1>
        </div>
    </header>

    <div class="container">
        <div class="controls">
            <input type="text" id="mapIdInput" placeholder="Enter map ID">
            <button id="loadMapBtn">Load Map</button>
        </div>

        <div class="map-container">
            <!-- The Felt map will be embedded here -->
            <div id="feltMap"></div>
        </div>

        <div class="map-list">
            <h2>Your Recent Maps</h2>
            <div id="mapsList">
                <!-- Map items will be populated here -->
            </div>
        </div>
    </div>

    <script>

        // Configuration
                // No longer needed in the frontend
        // const FELT_API_TOKEN = 'YOUR_FELT_API_TOKEN';

        // DOM Elements
        const mapIdInput = document.getElementById('mapIdInput');
        const loadMapBtn = document.getElementById('loadMapBtn');
        const mapsList = document.getElementById('mapsList');
        
        // Load a specific map when button is clicked
        loadMapBtn.addEventListener('click', () => {
            const mapId = mapIdInput.value.trim();
            if (mapId) {
                loadFeltMap(mapId);
            } else {
                alert('Please enter a valid map ID');
            }
        });
        
        // Function to load a Felt map using the embedding approach
        function loadFeltMap(mapId) {
            const mapContainer = document.getElementById('feltMap');
            
            // Clear existing content
            mapContainer.innerHTML = '';
            
            // Create an iframe to embed the Felt map
            const iframe = document.createElement('iframe');
            iframe.src = `https://felt.com/embed/map/${mapId}`;
            iframe.width = '100%';
            iframe.height = '100%';
            iframe.style.border = 'none';
            
            mapContainer.appendChild(iframe);
        }
        
        // Function to fetch user's maps using the Felt API
        // Function to fetch user's maps using your local server endpoint
async function fetchUserMaps() {
    try {
        // Call your local server endpoint instead of the Felt API directly
        const response = await fetch('/api/maps');
        
        if (!response.ok) {
            throw new Error('Failed to fetch maps');
        }
        
        const data = await response.json();
        displayMaps(data.maps || []);
    } catch (error) {
        console.error('Error fetching maps:', error);
        mapsList.innerHTML = `<p>Error loading maps: ${error.message}</p>`;
    }
}
        
        // Display list of maps
        function displayMaps(maps) {
            if (maps.length === 0) {
                mapsList.innerHTML = '<p>No maps found</p>';
                return;
            }
            
            const mapsHtml = maps.map(map => `
                <div class="map-item" data-id="${map.id}">
                    <h3>${map.title || 'Untitled Map'}</h3>
                    <p>${map.description || 'No description'}</p>
                    <small>Created: ${new Date(map.created_at).toLocaleDateString()}</small>
                </div>
            `).join('');
            
            mapsList.innerHTML = mapsHtml;
            
            // Add click event to map items
            document.querySelectorAll('.map-item').forEach(item => {
                item.addEventListener('click', () => {
                    const mapId = item.dataset.id;
                    mapIdInput.value = mapId;
                    loadFeltMap(mapId);
                });
            });
        }
        
        // Alternative: direct embedding of a specific map
        // Uncomment and modify this section to embed a specific map on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Replace with your actual map ID
            const defaultMapId = '9ASEgbuWeSYCjKi6McbxGvD';
            loadFeltMap(defaultMapId);
        });
        
        // Note: This would typically be done through a server-side API
         fetchUserMaps();
    </script>
</body>
</html>